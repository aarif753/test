<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Exam Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .quiz-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
        }
        
        .quiz-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .timer, .question-counter, .score-display {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .question-area {
            margin-bottom: 25px;
        }
        
        .question-number {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .question-img-container {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .question-img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-height: 400px;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            background-color: var(--light);
            border: 2px solid #ddd;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option:hover {
            background-color: #e9ecef;
            border-color: var(--primary);
        }
        
        .option.selected {
            background-color: #ffc107;
            color: #000;
            border-color: #ffc107;
        }
        
        .option.correct {
            background-color: #4bb543;
            color: white;
            border-color: #4bb543;
        }
        
        .option.wrong {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        .option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-prev {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-next {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-submit {
            background-color: var(--success);
            color: white;
        }
        
        .btn-submit-question {
            background-color: #6c757d;
            color: white;
            margin-right: 10px;
        }
        
        .btn-submit-question:hover {
            background-color: #5a6268;
        }
        
        .btn-explanation {
            background-color: var(--info);
            color: white;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 80%;
            max-width: 800px;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: var(--danger);
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .modal-title {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .explanation-media {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .explanation-media img, .explanation-media video {
            max-width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .explanation-text {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        .results-container {
            display: none;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-top: 30px;
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }
        
        .stat-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-card p {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .correct-stat {
            color: #4bb543;
        }
        
        .incorrect-stat {
            color: var(--danger);
        }
        
        .time-stat {
            color: var(--info);
        }
        
        .accuracy-stat {
            color: var(--warning);
        }
        
        .question-review {
            margin-top: 30px;
        }
        
        .review-item {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
            box-shadow: var(--box-shadow);
        }
        
        .review-question {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .review-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .correct-status {
            background-color: #d4edda;
            color: #155724;
        }
        
        .incorrect-status {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .skipped-status {
            background-color: #e5e7eb;
            color: #4b5563;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .review-options {
            margin-top: 10px;
        }
        
        .review-option {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        
        .selected-option {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .correct-option {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 20px;
            margin: 20px 0;
            height: 10px;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 20px;
            background: linear-gradient(90deg, var(--primary), var(--info));
            transition: width 0.3s ease;
        }
        
        .time-spent-chart {
            height: 300px;
            margin: 30px 0;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .tab-container {
            margin-top: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .floating-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: var(--box-shadow);
            z-index: 100;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 999;
            animation: confetti 5s ease-in-out;
        }
        
        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="spinner"></div>
        <h2>Loading Quiz...</h2>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> Advanced Exam Quiz</h1>
            <p>Test your knowledge and improve your skills</p>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="quiz-info">
                <div class="timer"><i class="fas fa-clock"></i> Time: <span id="clock">00:00:00</span></div>
                <div class="question-counter">Question <span id="currentQuestion">1</span> of <span id="totalQuestions">0</span></div>
                <div class="score-display"><i class="fas fa-star"></i> Score: <span id="currentScore">0</span></div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>

            <div class="question-area">
                <div class="question-number">Question <span id="questionNumber">1</span></div>
                <div class="question-img-container">
                    <img id="question-img" class="question-img" src="" alt="Question Image">
                </div>
                <button class="btn btn-explanation hidden" id="explanationBtn"><i class="fas fa-lightbulb"></i> Explanation</button>
            </div>

            <div class="options-container" id="optionsContainer">
                <!-- Options will be inserted here by JavaScript -->
            </div>

            <div class="controls">
                <button class="btn btn-prev" id="prevBtn"><i class="fas fa-arrow-left"></i> Previous</button>
                <div>
                    <button class="btn btn-submit-question hidden" id="submitQuestionBtn"><i class="fas fa-check"></i> Submit Answer</button>
                    <button class="btn btn-next" id="nextBtn">Next <i class="fas fa-arrow-right"></i></button>
                    <button class="btn btn-submit hidden" id="submitBtn"><i class="fas fa-paper-plane"></i> Submit Quiz</button>
                </div>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2><i class="fas fa-trophy"></i> Quiz Results</h2>
                <p>Here's how you performed</p>
            </div>

            <div class="results-stats">
                <div class="stat-card">
                    <h3>Correct Answers</h3>
                    <p class="correct-stat" id="correctAnswers">0</p>
                </div>
                <div class="stat-card">
                    <h3>Incorrect Answers</h3>
                    <p class="incorrect-stat" id="incorrectAnswers">0</p>
                </div>
                <div class="stat-card">
                    <h3>Skipped</h3>
                    <p class="time-stat" id="skippedAnswers">0</p>
                </div>
                <div class="stat-card">
                    <h3>Score</h3>
                    <p class="accuracy-stat" id="finalScore">0</p>
                </div>
            </div>

            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" data-tab="summary">Summary</div>
                    <div class="tab" data-tab="analysis">Detailed Analysis</div>
                    <div class="tab" data-tab="timing">Time Analysis</div>
                </div>

                <div class="tab-content active" id="summaryTab">
                    <div class="progress-container">
                        <div class="progress-bar" id="resultsProgressBar" style="width: 0%"></div>
                    </div>
                    <p>You answered <span id="correctCount">0</span> out of <span id="totalCount">0</span> questions correctly.</p>
                    <p>Your score: <span id="scoreSummary">0</span> (Correct: +4 each, Incorrect: -1 each)</p>
                    <p>Time spent: <span id="totalTimeSpent">0</span> minutes.</p>
                    <p>Accuracy: <span id="accuracyPercent">0</span>%</p>
                </div>

                <div class="tab-content" id="analysisTab">
                    <h3>Question Review</h3>
                    <div class="question-review" id="questionReview">
                        <!-- Question reviews will be inserted here -->
                    </div>
                </div>

                <div class="tab-content" id="timingTab">
                    <h3>Time Spent per Question</h3>
                    <div class="time-spent-chart" id="timeSpentChart">
                        <!-- Chart will be inserted here -->
                    </div>
                    <p>Average time per question: <span id="avgTimePerQuestion">0</span> seconds</p>
                    <p>Fastest question: #<span id="fastestQuestion">0</span> (<span id="fastestTime">0</span> seconds)</p>
                    <p>Slowest question: #<span id="slowestQuestion">0</span> (<span id="slowestTime">0</span> seconds)</p>
                </div>
            </div>

            <div class="controls" style="justify-content: center; margin-top: 30px;">
                <button class="btn btn-primary" id="restartQuizBtn"><i class="fas fa-redo"></i> Restart Quiz</button>
                <button class="btn btn-info" id="reviewAnswersBtn"><i class="fas fa-search"></i> Review Answers</button>
            </div>
        </div>
    </div>

    <!-- Explanation Modal -->
    <div class="modal" id="explanationModal">
        <div class="modal-content">
            <button class="close-btn" id="closeExplanation">&times;</button>
            <h3 class="modal-title"><i class="fas fa-lightbulb"></i> Explanation</h3>
            <div class="explanation-media">
                <img id="explanation-img" src="" alt="Explanation Image" style="display: none;">
                <video id="explanation-video" controls style="display: none;">
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <div class="explanation-text" id="explanationText"></div>
        </div>
    </div>

    <!-- Floating Timer -->
    <div class="floating-timer" id="floatingTimer">
        <i class="fas fa-clock"></i> <span id="floatingClock">00:00:00</span>
    </div>

    <script>
        // Quiz State
        const quizState = {
            currentQuestionIndex: 0,
            score: 0,
            correctAnswers: 0,
            incorrectAnswers: 0,
            skippedAnswers: 0,
            timeSpent: 0,
            questionTimes: [],
            startTime: null,
            endTime: null,
            answers: [],
            completed: false,
            questions: []
        };

        // DOM Elements
        const elements = {
            quizContainer: document.getElementById('quizContainer'),
            resultsContainer: document.getElementById('resultsContainer'),
            loadingScreen: document.getElementById('loadingScreen'),
            questionNumber: document.getElementById('questionNumber'),
            questionImage: document.getElementById('question-img'),
            optionsContainer: document.getElementById('optionsContainer'),
            explanationBtn: document.getElementById('explanationBtn'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            submitQuestionBtn: document.getElementById('submitQuestionBtn'),
            submitBtn: document.getElementById('submitBtn'),
            clock: document.getElementById('clock'),
            floatingClock: document.getElementById('floatingClock'),
            currentQuestion: document.getElementById('currentQuestion'),
            totalQuestions: document.getElementById('totalQuestions'),
            currentScore: document.getElementById('currentScore'),
            progressBar: document.getElementById('progressBar'),
            correctAnswers: document.getElementById('correctAnswers'),
            incorrectAnswers: document.getElementById('incorrectAnswers'),
            skippedAnswers: document.getElementById('skippedAnswers'),
            finalScore: document.getElementById('finalScore'),
            timeTaken: document.getElementById('totalTimeSpent'),
            accuracy: document.getElementById('accuracyPercent'),
            correctCount: document.getElementById('correctCount'),
            totalCount: document.getElementById('totalCount'),
            scoreSummary: document.getElementById('scoreSummary'),
            resultsProgressBar: document.getElementById('resultsProgressBar'),
            avgTimePerQuestion: document.getElementById('avgTimePerQuestion'),
            fastestQuestion: document.getElementById('fastestQuestion'),
            fastestTime: document.getElementById('fastestTime'),
            slowestQuestion: document.getElementById('slowestQuestion'),
            slowestTime: document.getElementById('slowestTime'),
            timeSpentChart: document.getElementById('timeSpentChart'),
            explanationModal: document.getElementById('explanationModal'),
            closeExplanation: document.getElementById('closeExplanation'),
            explanationImage: document.getElementById('explanation-img'),
            explanationVideo: document.getElementById('explanation-video'),
            explanationText: document.getElementById('explanationText'),
            restartQuizBtn: document.getElementById('restartQuizBtn'),
            reviewAnswersBtn: document.getElementById('reviewAnswersBtn'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            questionReview: document.getElementById('questionReview')
        };

        // Timer Variables
        let quizTimer;
        let questionStartTime;

        // Initialize the quiz
        async function initQuiz() {
            try {
                // Load questions from JSON file
                const response = await fetch('questions.json');
                if (!response.ok) throw new Error('Failed to load questions');
                
                const data = await response.json();
                quizState.questions = data.questions;
                quizState.questionTimes = Array(quizState.questions.length).fill(0);
                quizState.answers = Array(quizState.questions.length).fill(null);
                
                // Set up quiz info
                elements.totalQuestions.textContent = quizState.questions.length;
                
                // Hide loading screen and show quiz
                elements.loadingScreen.style.display = 'none';
                elements.quizContainer.style.display = 'block';
                
                // Start the quiz
                startQuiz();
            } catch (error) {
                console.error('Error loading quiz:', error);
                elements.loadingScreen.innerHTML = `
                    <div class="text-red-500 text-center">
                        <i class="fas fa-exclamation-triangle fa-3x mb-4"></i>
                        <h2 class="text-2xl font-bold mb-2">Failed to Load Quiz</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">
                            <i class="fas fa-sync-alt mr-2"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        // Start the quiz
        function startQuiz() {
            quizState.startTime = new Date();
            questionStartTime = new Date();
            
            // Start the timer
            startTimer();
            
            // Load the first question
            loadQuestion(quizState.currentQuestionIndex);
            
            // Update the progress bar
            updateProgressBar();
        }

        // Load a question
        function loadQuestion(index) {
            if (index < 0 || index >= quizState.questions.length) return;
            
            // Record time spent on previous question
            if (questionStartTime && quizState.currentQuestionIndex !== index) {
                const now = new Date();
                const timeSpent = Math.floor((now - questionStartTime) / 1000);
                quizState.questionTimes[quizState.currentQuestionIndex] = timeSpent;
                quizState.timeSpent += timeSpent;
            }
            
            quizState.currentQuestionIndex = index;
            questionStartTime = new Date();
            
            const question = quizState.questions[index];
            
            // Update question number
            elements.questionNumber.textContent = index + 1;
            elements.currentQuestion.textContent = index + 1;
            
            // Set question image
            elements.questionImage.src = question.image;
            elements.questionImage.alt = `Question ${index + 1}`;
            
            // Clear previous options
            elements.optionsContainer.innerHTML = '';
            
            // Create new options
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('button');
                optionElement.className = 'option';
                optionElement.textContent = String.fromCharCode(65 + i) + ') ' + option.text;
                optionElement.dataset.index = i + 1; // Using 1-based index for answers
                
                // Check if this question was already answered
                if (quizState.answers[index] !== null) {
                    if (quizState.answers[index] === i + 1) {
                        optionElement.classList.add('selected');
                    }
                    if (i + 1 === question.answer) {
                        optionElement.classList.add('correct');
                    } else if (quizState.answers[index] === i + 1 && quizState.answers[index] !== question.answer) {
                        optionElement.classList.add('wrong');
                    }
                    optionElement.disabled = true;
                }
                
                optionElement.addEventListener('click', () => selectOption(i + 1));
                elements.optionsContainer.appendChild(optionElement);
            });
            
            // Update navigation buttons
            elements.prevBtn.disabled = index === 0;
            elements.nextBtn.disabled = index === quizState.questions.length - 1;
            
            // Show submit button if on last question
            elements.submitBtn.classList.toggle('hidden', index !== quizState.questions.length - 1);
            
            // Set up explanation button
            elements.explanationBtn.onclick = () => showExplanation(index);
            
            // Hide submit question button and explanation button initially
            elements.submitQuestionBtn.classList.add('hidden');
            elements.explanationBtn.classList.add('hidden');
            
            // Update the progress bar
            updateProgressBar();
        }

        // Select an option
        function selectOption(optionIndex) {
            const options = document.querySelectorAll('.option');
            
            // Remove previous selection
            options.forEach(opt => opt.classList.remove('selected'));
            
            // Mark current selection
            options[optionIndex - 1].classList.add('selected');
            
            // Show submit question button
            elements.submitQuestionBtn.classList.remove('hidden');
        }

        // Submit selected answer
        function submitAnswer() {
            const selectedOption = document.querySelector('.option.selected');
            if (!selectedOption) {
                alert('Please select an answer first.');
                return;
            }

            const optionIndex = parseInt(selectedOption.dataset.index);
            const currentQuestion = quizState.questions[quizState.currentQuestionIndex];
            
            // Mark the answer in the state
            quizState.answers[quizState.currentQuestionIndex] = optionIndex;
            
            // Disable all options
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.disabled = true);
            
            // Mark correct and incorrect answers
            options.forEach((option, i) => {
                if (i + 1 === currentQuestion.answer) {
                    option.classList.add('correct');
                } else if (parseInt(option.dataset.index) === optionIndex && parseInt(option.dataset.index) !== currentQuestion.answer) {
                    option.classList.add('wrong');
                }
            });
            
            // Update score (NEET pattern: +4 for correct, -1 for incorrect)
            if (optionIndex === currentQuestion.answer) {
                quizState.correctAnswers++;
                quizState.score += 4;
            } else {
                quizState.incorrectAnswers++;
                quizState.score -= 1;
            }
            
            elements.currentScore.textContent = quizState.score;
            
            // Hide submit question button, show explanation button
            elements.submitQuestionBtn.classList.add('hidden');
            elements.explanationBtn.classList.remove('hidden');
            
            // Auto-advance to next question after 2 seconds (optional)
            if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
                setTimeout(() => {
                    loadQuestion(quizState.currentQuestionIndex + 1);
                }, 2000);
            }
        }

        // Show explanation
        function showExplanation(questionIndex) {
            const question = quizState.questions[questionIndex];
            const explanation = question.explanation;
            
            // Set explanation content
            elements.explanationText.textContent = explanation.text || "Explanation not available";
            
            // Show image or video
            if (explanation.video) {
                elements.explanationVideo.style.display = 'block';
                elements.explanationImage.style.display = 'none';
                elements.explanationVideo.src = explanation.video;
            } else if (explanation.image) {
                elements.explanationImage.style.display = 'block';
                elements.explanationVideo.style.display = 'none';
                elements.explanationImage.src = explanation.image;
            } else {
                elements.explanationImage.style.display = 'none';
                elements.explanationVideo.style.display = 'none';
            }
            
            // Show modal
            elements.explanationModal.style.display = 'block';
        }

        // Start the quiz timer
        function startTimer() {
            quizTimer = setInterval(() => {
                const now = new Date();
                const elapsed = Math.floor((now - quizState.startTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                elements.clock.textContent = timeString;
                elements.floatingClock.textContent = timeString;
                
                // Check if time limit is exceeded
                if (quizState.questions[0]?.timeLimit && elapsed >= quizState.questions[0].timeLimit) {
                    clearInterval(quizTimer);
                    submitQuiz();
                }
            }, 1000);
        }

        // Submit the quiz
        function submitQuiz() {
            clearInterval(quizTimer);
            quizState.endTime = new Date();
            quizState.completed = true;
            
            // Calculate final time spent
            const totalTime = Math.floor((quizState.endTime - quizState.startTime) / 1000);
            quizState.timeSpent = totalTime;
            
            // Calculate skipped answers
            quizState.skippedAnswers = quizState.answers.filter(a => a === null).length;
            
            // Show results
            showResults();
            
            // Create confetti effect if passed (assuming 50% is passing)
            if (quizState.score >= (quizState.questions.length * 2)) {
                createConfetti();
            }
        }

        // Show results
        function showResults() {
            elements.quizContainer.style.display = 'none';
            elements.resultsContainer.style.display = 'block';
            
            // Calculate accuracy
            const accuracy = Math.round((quizState.correctAnswers / quizState.questions.length) * 100);
            
            // Set results
            elements.correctAnswers.textContent = quizState.correctAnswers;
            elements.incorrectAnswers.textContent = quizState.incorrectAnswers;
            elements.skippedAnswers.textContent = quizState.skippedAnswers;
            elements.finalScore.textContent = quizState.score;
            
            // Format time taken
            const hours = Math.floor(quizState.timeSpent / 3600);
            const minutes = Math.floor((quizState.timeSpent % 3600) / 60);
            const seconds = quizState.timeSpent % 60;
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            elements.timeTaken.textContent = timeString;
            
            // Set summary info
            elements.correctCount.textContent = quizState.correctAnswers;
            elements.totalCount.textContent = quizState.questions.length;
            elements.accuracy.textContent = accuracy;
            elements.scoreSummary.textContent = quizState.score;
            elements.totalTimeSpent.textContent = Math.round(minutes + seconds / 60);
            
            // Update results progress bar
            elements.resultsProgressBar.style.width = `${accuracy}%`;
            
            // Generate question review
            generateQuestionReview();
            
            // Generate time analysis
            generateTimeAnalysis();
        }

        // Generate question review
        function generateQuestionReview() {
            elements.questionReview.innerHTML = '';
            
            quizState.questions.forEach((question, index) => {
                const userAnswer = quizState.answers[index];
                const isCorrect = userAnswer === question.answer;
                const isSkipped = userAnswer === null;
                
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                
                const reviewQuestion = document.createElement('div');
                reviewQuestion.className = 'review-question';
                
                const questionText = document.createElement('div');
                questionText.innerHTML = `<strong>Question ${index + 1}:</strong>`;
                
                let status;
                if (isSkipped) {
                    status = `<span class="skipped-status">Skipped</span>`;
                } else if (isCorrect) {
                    status = `<span class="correct-status">Correct</span>`;
                } else {
                    status = `<span class="incorrect-status">Incorrect</span>`;
                }
                
                reviewQuestion.appendChild(questionText);
                reviewQuestion.innerHTML += status;
                
                const questionImage = document.createElement('img');
                questionImage.src = question.image;
                questionImage.className = 'question-img';
                questionImage.alt = `Question ${index + 1}`;
                
                const reviewOptions = document.createElement('div');
                reviewOptions.className = 'review-options';
                
                const userSelection = document.createElement('p');
                if (isSkipped) {
                    userSelection.textContent = 'You skipped this question';
                } else {
                    const selectedOption = String.fromCharCode(64 + userAnswer);
                    userSelection.textContent = `Your answer: ${selectedOption}`;
                }
                
                const correctAnswer = document.createElement('p');
                const correctOption = String.fromCharCode(64 + question.answer);
                correctAnswer.textContent = `Correct answer: ${correctOption}`;
                
                const explanationBtn = document.createElement('button');
                explanationBtn.className = 'btn btn-explanation';
                explanationBtn.innerHTML = '<i class="fas fa-lightbulb"></i> Show Explanation';
                explanationBtn.onclick = () => showExplanation(index);
                
                reviewItem.appendChild(reviewQuestion);
                reviewItem.appendChild(questionImage);
                reviewItem.appendChild(userSelection);
                reviewItem.appendChild(correctAnswer);
                reviewItem.appendChild(explanationBtn);
                
                elements.questionReview.appendChild(reviewItem);
            });
        }

        // Generate time analysis
        function generateTimeAnalysis() {
            // Calculate average time
            const answeredQuestions = quizState.questionTimes.filter(time => time > 0);
            const avgTime = answeredQuestions.length > 0 
                ? Math.round(answeredQuestions.reduce((a, b) => a + b, 0) / answeredQuestions.length) 
                : 0;
            
            // Find fastest and slowest questions
            let fastestIndex = 0;
            let slowestIndex = 0;
            let fastestTime = answeredQuestions.length > 0 ? answeredQuestions[0] : 0;
            let slowestTime = answeredQuestions.length > 0 ? answeredQuestions[0] : 0;
            
            for (let i = 1; i < answeredQuestions.length; i++) {
                if (answeredQuestions[i] < fastestTime) {
                    fastestTime = answeredQuestions[i];
                    fastestIndex = i;
                }
                if (answeredQuestions[i] > slowestTime) {
                    slowestTime = answeredQuestions[i];
                    slowestIndex = i;
                }
            }
            
            // Set time analysis
            elements.avgTimePerQuestion.textContent = avgTime;
            elements.fastestQuestion.textContent = fastestIndex + 1;
            elements.fastestTime.textContent = fastestTime;
            elements.slowestQuestion.textContent = slowestIndex + 1;
            elements.slowestTime.textContent = slowestTime;
            
            // Simple chart visualization
            elements.timeSpentChart.innerHTML = '';
            const maxTime = Math.max(...quizState.questionTimes, 1);
            
            quizState.questionTimes.forEach((time, index) => {
                if (time > 0) {
                    const bar = document.createElement('div');
                    bar.style.height = `${(time / maxTime) * 100}%`;
                    bar.style.width = '20px';
                    bar.style.backgroundColor = time === fastestTime ? '#4CAF50' : time === slowestTime ? '#F44336' : '#2196F3';
                    bar.style.display = 'inline-block';
                    bar.style.margin = '0 2px';
                    bar.style.position = 'relative';
                    bar.title = `Q${index + 1}: ${time}s`;
                    
                    const label = document.createElement('div');
                    label.textContent = index + 1;
                    label.style.position = 'absolute';
                    label.style.bottom = '-20px';
                    label.style.left = '0';
                    label.style.fontSize = '10px';
                    label.style.textAlign = 'center';
                    label.style.width = '20px';
                    
                    bar.appendChild(label);
                    elements.timeSpentChart.appendChild(bar);
                }
            });
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((quizState.currentQuestionIndex + 1) / quizState.questions.length) * 100;
            elements.progressBar.style.width = `${progress}%`;
        }

        // Create confetti effect
        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Event Listeners
        elements.prevBtn.addEventListener('click', () => {
            if (quizState.currentQuestionIndex > 0) {
                loadQuestion(quizState.currentQuestionIndex - 1);
            }
        });

        elements.nextBtn.addEventListener('click', () => {
            if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
                loadQuestion(quizState.currentQuestionIndex + 1);
            }
        });

        elements.submitQuestionBtn.addEventListener('click', submitAnswer);

        elements.submitBtn.addEventListener('click', submitQuiz);

        elements.closeExplanation.addEventListener('click', () => {
            elements.explanationModal.style.display = 'none';
            // Pause video when closing
            if (elements.explanationVideo) {
                elements.explanationVideo.pause();
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === elements.explanationModal) {
                elements.explanationModal.style.display = 'none';
                // Pause video when closing
                if (elements.explanationVideo) {
                    elements.explanationVideo.pause();
                }
            }
        });

        elements.restartQuizBtn.addEventListener('click', () => {
            // Reset quiz state
            quizState.currentQuestionIndex = 0;
            quizState.score = 0;
            quizState.correctAnswers = 0;
            quizState.incorrectAnswers = 0;
            quizState.skippedAnswers = 0;
            quizState.timeSpent = 0;
            quizState.questionTimes = Array(quizState.questions.length).fill(0);
            quizState.answers = Array(quizState.questions.length).fill(null);
            quizState.completed = false;
            
            // Reset UI
            elements.currentScore.textContent = '0';
            elements.resultsContainer.style.display = 'none';
            elements.quizContainer.style.display = 'block';
            
            // Start quiz again
            startQuiz();
        });

        elements.reviewAnswersBtn.addEventListener('click', () => {
            // Switch to analysis tab
            document.querySelector('.tab[data-tab="analysis"]').click();
        });

        // Tab switching
        elements.tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                elements.tabs.forEach(t => t.classList.remove('active'));
                elements.tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}Tab`).classList.add('active');
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && quizState.currentQuestionIndex > 0) {
                loadQuestion(quizState.currentQuestionIndex - 1);
            } else if (e.key === 'ArrowRight' && quizState.currentQuestionIndex < quizState.questions.length - 1) {
                loadQuestion(quizState.currentQuestionIndex + 1);
            } else if (e.key === 'Enter' && quizState.currentQuestionIndex < quizState.questions.length - 1) {
                loadQuestion(quizState.currentQuestionIndex + 1);
            }
        });

        // Initialize the quiz when the page loads
        window.addEventListener('load', initQuiz);
    </script>
</body>
</html>
